<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('../partials/head',{title:title}) %>
        <link href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
        <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
</head>

<body>
    <%- include('../partials/navbar') %>
        <%- include('../partials/sidebar') %>
            <div class="p-4 sm:ml-64">
                <section class="bg-gray-50 p-3 sm:p-5">
                    <div class="bg-white shadow-md sm:rounded-lg mx-auto p-4 my-5">
                        <div class="flex justify-between items-center">
                            <h1 class="text-xl font-bold">List Betting</h1>
                        </div>
                    </div>

                    <div class="bg-white shadow-md sm:rounded-lg mx-auto p-4 my-5 relative overflow-x-auto">
                        <table id="indexData" class="display w-full text-sm text-gray-500 ">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-50 ">
                                <tr>
                                    <th>Action</th>
                                    <th>#</th>
                                    <th>Total Amount</th>
                                    <th>Out Amount</th>
                                    <th>Total User</th>
                                    <th>Game Strategy Id</th>
                                    <th>Result</th>
                                    <th>CreatedAt</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </section>
            </div>

            <script>
                $(document).ready(function () {
                    $('#indexData').DataTable({
                        serverSide: true,
                        ajax: {
                            url: "/betting/getData",
                            type: "GET",
                            data: function (d) {
                                return $.extend({}, d, {});
                            }
                        },
                        columns: [
                            {
                                "data": null,
                                "render": function (data) {
                                    let resData = `<a href="/betting/${data.id}" class="mx-2 text-blue-500"><i class="fas fa-eye"></i></a>`;
                                    if (data?.status) {
                                        resData += `<p data-id="${data.id}" data-url="betting" class="mx-2 crashBetting text-red-500"><i class="fas fa-trash-alt"></i></p>`;
                                    }
                                    return resData;
                                }
                            },
                            { "data": "id" },
                            { "data": "total_amount" },
                            { "data": "total_out_amount" },
                            { "data": "total_users" },
                            { "data": "game_strategy_id" },
                            { "data": "result" },
                            { "data": "created_at" },
                        ],
                        pageLength: 50,
                    });

                    setInterval(() => {
                        $('#indexData').DataTable().ajax.reload();
                    }, 300000);

                    $('#indexData').on('click', '.crashBetting', function () {
                        var id = $(this).data('id');
                        var url = $(this).data('url');
                        // if (confirm('Are you sure you want to delete this record?')) {
                        $.ajax({
                            url: `/${url}/${id}`,
                            type: 'DELETE',
                            success: function (result) {
                                location.reload();
                            },
                            error: function (err) {
                                console.error('Error deleting record:', err);
                            }
                        });
                        // }
                    });
                });
            </script>
</body>

</html>