<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('../partials/head',{title:title}) %>
        <link href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
        <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
</head>

<body>
    <%- include('../partials/navbar') %>
        <%- include('../partials/sidebar') %>
            <div class="p-4 sm:ml-64">
                <section class="p-3 sm:p-5">
                    <div class="bg-white shadow-md sm:rounded-lg mx-auto p-4 my-5">
                        <div class="flex justify-between items-center">
                            <h1 class="text-xl font-bold">
                                <span class="mx-3">Game Strategy</span>
                            </h1>
                            <div class="flex">
                                <input type="number" name="gameAdd" id="gameAdd"
                                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full px-2">
                                <button type="button"
                                    class="gameAddBtn text-white bg-gradient-to-r from-cyan-400 via-cyan-500 to-cyan-600 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-cyan-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center mx-3 mb-2">Add</button>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white shadow-md sm:rounded-lg mx-auto p-4 my-5">
                        <% if(errorMsg!="" ){ %>
                            <p class="text-red-500 my-3">
                                <%= errorMsg %>
                            </p>
                            <% } %>
                                <form class="mx-auto" action="/game-strategy/change-update" method="post">
                                    <label for="game_option" class="block mb-2 text-sm font-medium text-gray-900">Game
                                        Option
                                        :</label>
                                    <div class="grid lg:grid-cols-5 grid-cols-2 gap-4 mb-5" id="newGameOptions">
                                        <% if (getData && getData.length> 0) { %>
                                            <% getData.forEach((data, index)=> { %>
                                                <div id="gameOption<%= ++index %>">
                                                    <div class="flex justify-between">
                                                        <label for="game_option"
                                                            class="block mb-2 text-sm font-medium text-gray-900">
                                                            <%= index %>
                                                                :
                                                        </label>
                                                        <p class="text-red-500 text-2xl me-4 cancelOption"
                                                            data-id="<%= index %>">x</p>
                                                    </div>
                                                    <input type="number" name="game_option[]"
                                                        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                                                        placeholder="1.5" value="<%= data?.game_option %>" step="0.01"
                                                        required />
                                                </div>
                                                <% }) }%>
                                    </div>

                                    <button type="submit"
                                        class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center">Submit</button>
                                </form>

                    </div>
                </section>

            </div>

            <script>
                $(document).ready(function () {
                    console.log("document ready.");
                    let gameOptionCount = parseInt('<%= getData ? getData.length : 0 %>', 0);
                    console.log("gameOptionCount =>", typeof gameOptionCount, gameOptionCount);

                    $('.gameAddBtn').click(function () {
                        const gameAddInput = parseInt($('#gameAdd').val(), 10);
                        if (isNaN(gameAddInput) || gameAddInput <= 0) {
                            alert("Please enter a valid number of game options to add.");
                            return;
                        }

                        for (let i = 0; i < gameAddInput; i++) {
                            gameOptionCount++;
                            // Create a new div with the new game option input field
                            const newGameOption = `
                                <div id="gameOption${gameOptionCount}">
                                    <div class="flex justify-between">
                                        <label for="game_option" class="block mb-2 text-sm font-medium text-gray-900">${gameOptionCount}:</label>
                                        <p class="text-red-500 text-2xl me-4 cancelOption" data-id="${gameOptionCount}">x</p>
                                    </div>
                                    <input type="number" name="game_option[]"
                                        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                                        placeholder="1.5" step="0.01" required/>
                                </div>`;

                            // Append the new input field to the container
                            $('#newGameOptions').append(newGameOption);
                        }

                        // Re-attach the click event to the new cancel buttons
                        $('.cancelOption').off('click').on('click', function () {
                            $(this).parent().parent().remove();
                        });
                    });

                    $('.cancelOption').click(function () {
                        const id = $(this).data('id');
                        $(this).parent().parent().remove();
                    });
                });
            </script>

</body>

</html>